# RagNIROC: A new-age, ML interpolator for the Near Infrared spectrum -- based on [MIOLNIR](https://github.com/deniderveni/MIOLNIR)

MIOLNIR: Modelling and Interpolation across Observed Luminosities in the Near Infra Red
MIOLNIR utilised an interpolation method that has stringent limitations on its choice of stars. In other words, they must be worthy.
It was a custom, simplistic Radial Basis Function (RBF) interpolator - it was also my first ever full Python project! Built alongside Christopher Wilson (see MIOLNIR)

Meanwhile, RagNIROC uses a formal RBF interpolator to optimise fitting hyperparameters for nearby stellar spectra, with greater elegance and modularity.
It also begins to use regression techniques to create spectral models which, once I have greater confidence in its ability, will be saved and used in its finality to predict stellar spectra.


This repository is a WIP. It is fully functional but currently contains relics from MIOLNIR.
Over time, I will develop this into a formal, stand-alone package. For now, it serves as a proof-of-concept for the methodology.

## Usage

Run `run.py` to:
- Create a Stellar Population


`run.py` sets initial values for all the variables where necessary. It then runs the following programs:
  - **Old code** `stpars()` - This code calculates the Teff, logg and Z components of several stars along an isochrone. Currently, the only isochrone in use is Padova age 10Gyr, but outputs exist for all types.
  - `interpall()` - This creates interpolated spectra for all the stars contained in the stpars output files, using an RBF Interpolation scheme.
  - **Old code** `SSP_model()` - This combines all the spectra together to create an SSP.

There is also `SuitabilityPlots.py`:
  - This creates a set of plots based on the fitting parameters from `interpall()`. 
  

## Installation

To install Pyphot must first be installed:

```unix
pip install git+https://github.com/mfouesneau/pyphot
```

Any troubles see http://mfouesneau.github.io/docs/pyphot/.

Next just clone this repository
```unix
git clone https://github.com/deniderveni/RagNIROC
```

The contained codes and their functions:

## stpars.py

stpars.py contains 3 different functions: stpars(), gettracks() and set_stpars_filename().

**stpars(n_ms, n_rg, feh, afe, age, logg_cn = 3, fig = False, iso = 'DARTMOUTH')**
  - stpars uses the following required inputs:
    - n_ms = number of main sequence stars
    - n_rg = number of red giant stars
    - feh = iron abundance [Fe/H]
    - afe = [alpha/Fe]
    - age = age of the population (in Gyrs)
    
  - stpars uses the following additional inputs:
    - logg_cn = stars with logg <= logg_cn
    - fig = logical, whether you want the isochrone plotted or not
    - iso = isochrone model used, currently supports DARTMOUTH or PADOVA

stpars finds the appropriate isochrone for the desired inputs and calculates the Teff and logg of the n_ms stars on the main sequence and n_rg on the red giant branch. It outputs a table of the Teff's, logg's, masses, Hband logL's and their respective phases in a .dat file found in the folder Stellar_pars.

**gettracks(feh, afe, age, iso = 'DARTMOUTH')**

gettracks uses the previously defined parameters to find the correct isochrone. It outputs the file path of the isochrone selected.

**set_stpars_filename(n_ms, n_rg, feh, afe, age, logg_cn = 3)**

This outputs the filename and path for the parameter file given the previously defined inputs.

# Stellar Spectra Interpolation

This project generates interpolated stellar spectra using the IRTF spectral library and stellar parameters (Teff, logg, Z). It includes utilities for population synthesis, performance testing, and classification evaluation.

---

## interp.py

This script handles stellar spectra interpolation based on target stellar parameters.

### Functions

#### `interpolate(Teff_new, logg_new, Z_new, plot=True, save=True)`

Interpolates a spectrum from the IRTF library for a star with the given parameters.

**Parameters:**
- `Teff_new`: Effective temperature in Kelvin  
- `logg_new`: Surface gravity (log(g))  
- `Z_new`: Metallicity  
- `plot`: (bool) Save diagnostic plot to `Stellar_Spectra/` (default: `True`)  
- `save`: (bool) Save `.npy` file to `Stellar_Spectra/` (default: `True`)  

**Returns:**
- Wavelength array  
- Flux array (interpolated spectrum)  
- List of IDs of the three closest spectra used in interpolation

---

#### `interpall(n_ms, n_rg, feh, afe, age, Z)`

Interpolates spectra for an entire isochrone population using stellar parameters generated by `stpars.py`.

**Parameters:**
- `n_ms`: Number of main sequence stars  
- `n_rg`: Number of red giant stars  
- `feh`: [Fe/H] metallicity  
- `afe`: [Î±/Fe] abundance  
- `age`: Stellar population age (Gyr)  
- `Z`: Metallicity for interpolation  

Saves spectra and plots in the `Stellar_Spectra/` directory.

---

#### `test_interpolation(sample_size=50)`

Evaluates interpolation accuracy by holding out `sample_size` spectra and comparing predictions to true values.

**Parameters:**
- `sample_size`: Number of IRTF spectra to hold out for testing  

**Output:**
- RMSE calculation  
- Diagnostic plots  
- Prints interpolation quality statistics

---

#### `evaluate_classification(sample_size=50, param='Teff', n_bins=3)`

Performs classification testing using k-NN on IRTF spectra.

**Parameters:**
- `sample_size`: Number of spectra to sample  
- `param`: Stellar parameter to classify (`'Teff'`, `'logg'`, or `'Z'`)  
- `n_bins`: Number of parameter bins to classify  

**Output:**
- ROC curves  
- Precision/recall metrics  
- Confusion matrix  
- Diagnostic plots

---

## retrieve_irtf.py

Utilities for retrieving and processing IRTF spectral data and metadata.

### Functions

#### `param_retrieve()`

Reads `irtf_param.txt` and returns structured stellar parameter data.

**Returns:**
- Structured NumPy array with fields like ID, Teff, logg, Z, etc.

---

#### `get_spectra(ID)`

Retrieves a spectrum from the IRTF FITS files.

**Parameters:**
- `ID`: Spectrum ID string (e.g. `'IRL012'`)  

**Returns:**
- Wavelength array  
- Flux array

---

#### `set_spectra_name(Teff, logg, Z)`

Generates a standardised filename based on stellar parameters.

**Parameters:**
- `Teff`: Effective temperature  
- `logg`: Surface gravity  
- `Z`: Metallicity  

**Returns:**
- Formatted filename string for saving interpolated spectra

---



## SSP_model.py

SSP_model is an apdated version of https://github.com/marinatrevisan/SynSSP_PFANTnew.
